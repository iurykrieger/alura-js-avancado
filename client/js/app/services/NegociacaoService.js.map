{"version":3,"sources":["../../app-es6/services/NegociacaoService.js"],"names":["HttpService","ConnectionFactory","NegociacaoDao","Negociacao","NegociacaoService","_baseUrl","_http","Promise","all","getWeekNegociacoes","getLastWeekNegociacoes","getLastWeekBeforeNegociacoes","then","negociacoes","reduce","flatArray","array","concat","catch","Error","error","get","map","Date","item","data","quantidade","valor","console","log","xhr","responseText","negociacao","getConnection","connection","dao","save","deleteAll","getAll","list","getAllNegociacoes","filter","exists","newNegociacao"],"mappings":";;;;;;;;;;;;;;;AAASA,c,gBAAAA,W;;AACAC,oB,+BAAAA,iB;;AACAC,gB,qBAAAA,a;;AACAC,a,qBAAAA,U;;;;;;;;;;;;;;;;;;;;;gCAEIC,iB;AACZ,iCAAc;AAAA;;AACb,UAAKC,QAAL,GAAgB,aAAhB;AACA,UAAKC,KAAL,GAAa,IAAIN,WAAJ,EAAb;AACA;;;;yCAEmB;AACnB,aAAOO,QAAQC,GAAR,CAAY,CAClB,KAAKC,kBAAL,EADkB,EAElB,KAAKC,sBAAL,EAFkB,EAGlB,KAAKC,4BAAL,EAHkB,CAAZ,EAKLC,IALK,CAKA;AAAA,cACLC,YAAYC,MAAZ,CAAmB,UAACC,SAAD,EAAYC,KAAZ;AAAA,eAAsBD,UAAUE,MAAV,CAAiBD,KAAjB,CAAtB;AAAA,QAAnB,EAAkE,EAAlE,CADK;AAAA,OALA,EAQLE,KARK,CAQC;AAAA,cAAS,IAAIC,KAAJ,CAAUC,KAAV,CAAT;AAAA,OARD,CAAP;AASA;;;0CAEoB;AACpB,aAAO,KAAKd,KAAL,CACLe,GADK,CACE,KAAKhB,QADP,cAELO,IAFK,CAEA;AAAA,cACLI,MAAMM,GAAN,CAAU;AAAA,eAAQ,IAAInB,UAAJ,CAAe,IAAIoB,IAAJ,CAASC,KAAKC,IAAd,CAAf,EAAoCD,KAAKE,UAAzC,EAAqDF,KAAKG,KAA1D,CAAR;AAAA,QAAV,CADK;AAAA,OAFA,EAKLT,KALK,CAKC,iBAAS;AACfU,eAAQC,GAAR,CAAYC,IAAIC,YAAhB;AACA,aAAM,IAAIZ,KAAJ,CAAU,kDAAV,CAAN;AACA,OARK,CAAP;AASA;;;8CAEwB;AACxB,aAAO,KAAKb,KAAL,CACLe,GADK,CACE,KAAKhB,QADP,gBAELO,IAFK,CAEA;AAAA,cACLI,MAAMM,GAAN,CAAU;AAAA,eAAQ,IAAInB,UAAJ,CAAe,IAAIoB,IAAJ,CAASC,KAAKC,IAAd,CAAf,EAAoCD,KAAKE,UAAzC,EAAqDF,KAAKG,KAA1D,CAAR;AAAA,QAAV,CADK;AAAA,OAFA,EAKLT,KALK,CAKC,iBAAS;AACfU,eAAQC,GAAR,CAAYC,IAAIC,YAAhB;AACA,aAAM,IAAIZ,KAAJ,CAAU,2DAAV,CAAN;AACA,OARK,CAAP;AASA;;;oDAE8B;AAC9B,aAAO,KAAKb,KAAL,CACLe,GADK,CACE,KAAKhB,QADP,iBAELO,IAFK,CAEA;AAAA,cACLI,MAAMM,GAAN,CAAU;AAAA,eAAQ,IAAInB,UAAJ,CAAe,IAAIoB,IAAJ,CAASC,KAAKC,IAAd,CAAf,EAAoCD,KAAKE,UAAzC,EAAqDF,KAAKG,KAA1D,CAAR;AAAA,QAAV,CADK;AAAA,OAFA,EAKLT,KALK,CAKC,iBAAS;AACfU,eAAQC,GAAR,CAAYC,IAAIC,YAAhB;AACA,aAAM,IAAIZ,KAAJ,CAAU,kDAAV,CAAN;AACA,OARK,CAAP;AASA;;;0BAEIa,U,EAAY;AAChB,aAAO/B,kBAAkBgC,aAAlB,GACLrB,IADK,CACA;AAAA,cAAc,IAAIV,aAAJ,CAAkBgC,UAAlB,CAAd;AAAA,OADA,EAELtB,IAFK,CAEA;AAAA,cAAOuB,IAAIC,IAAJ,CAASJ,UAAT,CAAP;AAAA,OAFA,EAGLd,KAHK,CAGC;AAAA,cAAS,IAAIC,KAAJ,CAAUC,KAAV,CAAT;AAAA,OAHD,CAAP;AAIA;;;iCAEW;AACX,aAAOnB,kBAAkBgC,aAAlB,GACLrB,IADK,CACA;AAAA,cAAc,IAAIV,aAAJ,CAAkBgC,UAAlB,CAAd;AAAA,OADA,EAELtB,IAFK,CAEA;AAAA,cAAOuB,IAAIE,SAAJ,EAAP;AAAA,OAFA,EAGLnB,KAHK,CAGC;AAAA,cAAS,IAAIC,KAAJ,CAAUC,KAAV,CAAT;AAAA,OAHD,CAAP;AAIA;;;+BAES;AACT,aAAOnB,kBAAkBgC,aAAlB,GACLrB,IADK,CACA;AAAA,cAAc,IAAIV,aAAJ,CAAkBgC,UAAlB,CAAd;AAAA,OADA,EAELtB,IAFK,CAEA;AAAA,cAAOuB,IAAIG,MAAJ,EAAP;AAAA,OAFA,EAGLpB,KAHK,CAGC;AAAA,cAAS,IAAIC,KAAJ,CAAUC,KAAV,CAAT;AAAA,OAHD,CAAP;AAIA;;;6BAEMmB,I,EAAM;AACZ,aAAO,KAAKC,iBAAL,GACL5B,IADK,CACA;AAAA,cAAeC,YAAY4B,MAAZ,CAAmB;AAAA,eAAiB,CAACF,KAAKG,MAAL,CAAYC,aAAZ,CAAlB;AAAA,QAAnB,CAAf;AAAA,OADA,EAELzB,KAFK,CAEC;AAAA,cAAS,IAAIC,KAAJ,CAAUC,KAAV,CAAT;AAAA,OAFD,CAAP;AAGA","file":"NegociacaoService.js","sourcesContent":["import { HttpService } from './HttpService';\nimport { ConnectionFactory } from '../factories/ConnectionFactory';\nimport { NegociacaoDao } from '../dao/NegociacaoDao';\nimport { Negociacao } from '../models/Negociacao';\n\nexport class NegociacaoService {\n\tconstructor() {\n\t\tthis._baseUrl = 'negociacoes';\n\t\tthis._http = new HttpService();\n\t}\n\n\tgetAllNegociacoes() {\n\t\treturn Promise.all([\n\t\t\tthis.getWeekNegociacoes(),\n\t\t\tthis.getLastWeekNegociacoes(),\n\t\t\tthis.getLastWeekBeforeNegociacoes()\n\t\t])\n\t\t\t.then(negociacoes =>\n\t\t\t\tnegociacoes.reduce((flatArray, array) => flatArray.concat(array), [])\n\t\t\t)\n\t\t\t.catch(error => new Error(error));\n\t}\n\n\tgetWeekNegociacoes() {\n\t\treturn this._http\n\t\t\t.get(`${this._baseUrl}/semana`)\n\t\t\t.then(array =>\n\t\t\t\tarray.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor))\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\tconsole.log(xhr.responseText);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana.');\n\t\t\t});\n\t}\n\n\tgetLastWeekNegociacoes() {\n\t\treturn this._http\n\t\t\t.get(`${this._baseUrl}/anterior`)\n\t\t\t.then(array =>\n\t\t\t\tarray.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor))\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\tconsole.log(xhr.responseText);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana anterior.');\n\t\t\t});\n\t}\n\n\tgetLastWeekBeforeNegociacoes() {\n\t\treturn this._http\n\t\t\t.get(`${this._baseUrl}/retrasada`)\n\t\t\t.then(array =>\n\t\t\t\tarray.map(item => new Negociacao(new Date(item.data), item.quantidade, item.valor))\n\t\t\t)\n\t\t\t.catch(error => {\n\t\t\t\tconsole.log(xhr.responseText);\n\t\t\t\tthrow new Error('Não foi possível obter as negociações da semana.');\n\t\t\t});\n\t}\n\n\tsave(negociacao) {\n\t\treturn ConnectionFactory.getConnection()\n\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t.then(dao => dao.save(negociacao))\n\t\t\t.catch(error => new Error(error));\n\t}\n\n\tdeleteAll() {\n\t\treturn ConnectionFactory.getConnection()\n\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t.then(dao => dao.deleteAll())\n\t\t\t.catch(error => new Error(error));\n\t}\n\n\tloadAll() {\n\t\treturn ConnectionFactory.getConnection()\n\t\t\t.then(connection => new NegociacaoDao(connection))\n\t\t\t.then(dao => dao.getAll())\n\t\t\t.catch(error => new Error(error));\n\t}\n\n\timport(list) {\n\t\treturn this.getAllNegociacoes()\n\t\t\t.then(negociacoes => negociacoes.filter(newNegociacao => !list.exists(newNegociacao)))\n\t\t\t.catch(error => new Error(error));\n\t}\n}\n"]}